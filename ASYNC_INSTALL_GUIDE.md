# å¼‚æ­¥ä¾èµ–å®‰è£…ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

ä¸ºäº†è§£å†³ RunPod ä¸Š SSH è¿æ¥ä¸ç¨³å®šå¯¼è‡´ä¾èµ–å®‰è£…ä¸­æ–­çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ·»åŠ äº†åå°å¼‚æ­¥å®‰è£…åŠŸèƒ½ã€‚

## æ ¸å¿ƒç‰¹æ€§

- âœ… **åå°æ‰§è¡Œ**ï¼šSSH æ–­å¼€åï¼Œå®‰è£…è¿›ç¨‹ç»§ç»­è¿è¡Œ
- âœ… **ä»»åŠ¡è·Ÿè¸ª**ï¼šéšæ—¶æŸ¥çœ‹å®‰è£…è¿›åº¦å’ŒçŠ¶æ€
- âœ… **ç»“æ„åŒ–æ—¥å¿—**ï¼šè¯¦ç»†çš„è¿›åº¦ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®
- âœ… **å‘åå…¼å®¹**ï¼šä¸åŠ  `--async` æ—¶è¡Œä¸ºå®Œå…¨ä¸å˜
- âš¡ **uv åŠ é€Ÿ**ï¼šè‡ªåŠ¨ä½¿ç”¨ uv æ›¿ä»£ pipï¼Œå®‰è£…é€Ÿåº¦æå‡ 10-100 å€

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨å¼‚æ­¥å®‰è£…

```bash
python3 volume_cli.py deps install --project speaker-reg --async
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
============================================================
ğŸš€ åå°ä»»åŠ¡å·²å¯åŠ¨
============================================================
ğŸ“‹ ä»»åŠ¡ID: deps_install_20251227_141126_a3f2
ğŸ“ æ—¥å¿—æ–‡ä»¶: /runpod-volume/.metadata/tasks/deps_install_20251227_141126_a3f2.log

æŸ¥çœ‹è¿›åº¦:
  python3 volume_cli.py deps status deps_install_20251227_141126_a3f2

å®æ—¶è·Ÿè¸ªæ—¥å¿—:
  tail -f /runpod-volume/.metadata/tasks/deps_install_20251227_141126_a3f2.log
```

### 2. æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€

#### æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡

```bash
python3 volume_cli.py deps status
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
============================================================
ğŸ“‹ ä»»åŠ¡åˆ—è¡¨
============================================================

ğŸ”„ deps_install_20251227_141126_a3f2
   å‘½ä»¤: deps install --project speaker-reg --async
   å¼€å§‹: 2025-12-27T14:11:26
   çŠ¶æ€: running

âœ… deps_install_20251227_120530_b7d9
   å‘½ä»¤: deps install --project speaker-reg --async
   å¼€å§‹: 2025-12-27T12:05:30
   çŠ¶æ€: completed

ğŸ’¡ æŸ¥çœ‹è¯¦æƒ…:
   python3 volume_cli.py deps status <task_id>
```

#### æŸ¥çœ‹ç‰¹å®šä»»åŠ¡è¯¦æƒ…

```bash
python3 volume_cli.py deps status deps_install_20251227_141126_a3f2
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
============================================================
ğŸ“‹ ä»»åŠ¡: deps_install_20251227_141126_a3f2
============================================================
ğŸ“¦ å‘½ä»¤: deps install --project speaker-reg --async
â±ï¸  å¼€å§‹æ—¶é—´: 2025-12-27T14:11:26
ğŸ”„ çŠ¶æ€: ğŸ”„ è¿è¡Œä¸­

ğŸ“Š è¿›åº¦:
  å½“å‰ç»„: standard (2/3)
  æ€»è¿›åº¦: 66% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘

ğŸ“ˆ ç»Ÿè®¡:
  âœ… æˆåŠŸ: 2 ç»„
  âŒ å¤±è´¥: 0 ç»„
  ğŸ”„ é‡è¯•: 0 æ¬¡

ğŸ’¡ å®æ—¶æ—¥å¿—:
  tail -f /runpod-volume/.metadata/tasks/deps_install_20251227_141126_a3f2.log
```

### 3. åœæ­¢ä»»åŠ¡

#### ä¼˜é›…åœæ­¢ï¼ˆæ¨èï¼‰

```bash
python3 volume_cli.py deps stop deps_install_20251227_141126_a3f2
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
============================================================
âœ… ä»»åŠ¡å·²åœæ­¢
============================================================
ğŸ“‹ ä»»åŠ¡ID: deps_install_20251227_141126_a3f2
âœ… ä¼˜é›…ç»ˆæ­¢ (SIGTERM)
```

#### å¼ºåˆ¶åœæ­¢

```bash
python3 volume_cli.py deps stop deps_install_20251227_141126_a3f2 --force
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
============================================================
âœ… ä»»åŠ¡å·²åœæ­¢
============================================================
ğŸ“‹ ä»»åŠ¡ID: deps_install_20251227_141126_a3f2
âš ï¸  ä½¿ç”¨å¼ºåˆ¶ç»ˆæ­¢ (SIGKILL)
```

### 4. å®æ—¶è·Ÿè¸ªæ—¥å¿—

```bash
tail -f /runpod-volume/.metadata/tasks/deps_install_20251227_141126_a3f2.log
```

æ—¥å¿—åŒ…å«ï¼š

- å®‰è£…è¿›åº¦ï¼ˆå½“å‰ç»„/æ€»ç»„æ•°ï¼‰
- æ¯ä¸ªç»„çš„å®‰è£…æ—¶é—´
- æˆåŠŸ/å¤±è´¥çŠ¶æ€
- è¯¦ç»†çš„ pip è¾“å‡º

## æ—¥å¿—æ ¼å¼

æ—¥å¿—ä¸­åŒ…å«ç»“æ„åŒ–æ ‡è®°ï¼Œä¾¿äºè§£æï¼š

```
[PROGRESS] group=pytorch current=1 total=3
[SUCCESS] group=pytorch time=120s packages=2
[FAILED] group=standard exitcode=1
```

## ä»»åŠ¡çŠ¶æ€

- **running** ğŸ”„ï¼šæ­£åœ¨è¿è¡Œ
- **completed** âœ…ï¼šå·²å®Œæˆ
- **failed** âŒï¼šå¤±è´¥
- **stopped** ğŸ›‘ï¼šå·²åœæ­¢
- **unknown** â“ï¼šæœªçŸ¥ï¼ˆè¿›ç¨‹å¼‚å¸¸é€€å‡ºï¼‰

## ç›®å½•ç»“æ„

ä»»åŠ¡ç›¸å…³æ–‡ä»¶å­˜å‚¨åœ¨ï¼š

```
<VOLUME>/.metadata/tasks/
â”œâ”€â”€ deps_install_20251227_141126_a3f2.json    # ä»»åŠ¡å…ƒæ•°æ®
â”œâ”€â”€ deps_install_20251227_141126_a3f2.log     # ä»»åŠ¡æ—¥å¿—
â””â”€â”€ ...
```

## å¸¸è§åœºæ™¯

### åœºæ™¯ 1ï¼šSSH æ–­å¼€åç»§ç»­å®‰è£…

```bash
# 1. å¯åŠ¨å¼‚æ­¥å®‰è£…
python3 volume_cli.py deps install --project speaker-reg --async

# 2. è®°ä¸‹ä»»åŠ¡IDï¼ˆä¾‹å¦‚ï¼šdeps_install_20251227_141126_a3f2ï¼‰

# 3. SSH æ–­å¼€åé‡æ–°è¿æ¥

# 4. æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
python3 volume_cli.py deps status deps_install_20251227_141126_a3f2
```

### åœºæ™¯ 2ï¼šåŒæ—¶å®‰è£…å¤šä¸ªé¡¹ç›®

```bash
# å¯åŠ¨å¤šä¸ªå¼‚æ­¥ä»»åŠ¡
python3 volume_cli.py deps install --project project-a --async
python3 volume_cli.py deps install --project project-b --async

# æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
python3 volume_cli.py deps status
```

### åœºæ™¯ 3ï¼šåœæ­¢è¿è¡Œä¸­çš„ä»»åŠ¡

```bash
# 1. æŸ¥çœ‹è¿è¡Œä¸­çš„ä»»åŠ¡
python3 volume_cli.py deps status

# 2. ä¼˜é›…åœæ­¢ä»»åŠ¡
python3 volume_cli.py deps stop deps_install_20251227_141126_a3f2

# 3. å¦‚æœä¼˜é›…åœæ­¢æ— æ•ˆï¼Œä½¿ç”¨å¼ºåˆ¶åœæ­¢
python3 volume_cli.py deps stop deps_install_20251227_141126_a3f2 --force
```

### åœºæ™¯ 4ï¼šè°ƒè¯•å®‰è£…é—®é¢˜

```bash
# 1. å¯åŠ¨å¼‚æ­¥å®‰è£…
python3 volume_cli.py deps install --project speaker-reg --async

# 2. å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f /runpod-volume/.metadata/tasks/deps_install_20251227_141126_a3f2.log

# 3. å¦‚æœå¤±è´¥ï¼Œæ—¥å¿—æ–‡ä»¶ä¼šä¿ç•™ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†é”™è¯¯
```

## æ³¨æ„äº‹é¡¹

1. **ä»»åŠ¡ ID å”¯ä¸€æ€§**ï¼šæ¯æ¬¡è¿è¡Œéƒ½ä¼šç”Ÿæˆæ–°çš„ä»»åŠ¡ ID
2. **æ—¥å¿—æ–‡ä»¶ä¿ç•™**ï¼šä»»åŠ¡å®Œæˆåæ—¥å¿—æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†
3. **è¿›ç¨‹ç®¡ç†**ï¼šåå°è¿›ç¨‹ä½¿ç”¨ `start_new_session=True`ï¼Œä¸å½“å‰ä¼šè¯è„±ç¦»
4. **åŒæ­¥æ¨¡å¼**ï¼šä¸åŠ  `--async` å‚æ•°æ—¶ï¼Œè¡Œä¸ºä¸ä¹‹å‰å®Œå…¨ä¸€è‡´

## ä¸åŒæ­¥æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§     | åŒæ­¥æ¨¡å¼      | å¼‚æ­¥æ¨¡å¼          |
| -------- | ------------- | ----------------- |
| SSH æ–­å¼€ | âŒ å®‰è£…ä¸­æ–­   | âœ… ç»§ç»­è¿è¡Œ       |
| å®æ—¶è¾“å‡º | âœ… ç›´æ¥æ˜¾ç¤º   | âš ï¸ éœ€è¦ tail -f   |
| è¿›åº¦æŸ¥è¯¢ | âŒ ä¸æ”¯æŒ     | âœ… éšæ—¶æŸ¥è¯¢       |
| ä»»åŠ¡ç®¡ç† | âŒ ä¸æ”¯æŒ     | âœ… æ”¯æŒ           |
| ä½¿ç”¨åœºæ™¯ | æœ¬åœ°/ç¨³å®šè¿æ¥ | RunPod/ä¸ç¨³å®šè¿æ¥ |

## æ•…éšœæ’æŸ¥

### ä»»åŠ¡çŠ¶æ€æ˜¾ç¤º "unknown"

å¯èƒ½åŸå› ï¼š

- è¿›ç¨‹å¼‚å¸¸é€€å‡º
- ç³»ç»Ÿèµ„æºä¸è¶³
- æƒé™é—®é¢˜

è§£å†³æ–¹æ³•ï¼š

```bash
# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æœ€åå‡ è¡Œ
tail -n 50 /runpod-volume/.metadata/tasks/<task_id>.log
```

### æ‰¾ä¸åˆ°ä»»åŠ¡

å¯èƒ½åŸå› ï¼š

- ä»»åŠ¡ ID è¾“å…¥é”™è¯¯
- ä»»åŠ¡å…ƒæ•°æ®æ–‡ä»¶è¢«åˆ é™¤

è§£å†³æ–¹æ³•ï¼š

```bash
# åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
python3 volume_cli.py deps status

# æ£€æŸ¥ä»»åŠ¡ç›®å½•
ls -la /runpod-volume/.metadata/tasks/
```

## æ¸…ç†ä»»åŠ¡æ–‡ä»¶

ä»»åŠ¡æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨æ¸…ç†ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ é™¤ï¼š

```bash
# åˆ é™¤ç‰¹å®šä»»åŠ¡
rm /runpod-volume/.metadata/tasks/deps_install_20251227_141126_a3f2.*

# åˆ é™¤æ‰€æœ‰å·²å®Œæˆçš„ä»»åŠ¡ï¼ˆè°¨æ…æ“ä½œï¼‰
cd /runpod-volume/.metadata/tasks/
# æ‰‹åŠ¨æ£€æŸ¥ååˆ é™¤
```

## æŠ€æœ¯å®ç°

- **åå°è¿›ç¨‹**ï¼šä½¿ç”¨ `subprocess.Popen` + `start_new_session=True`
- **ä»»åŠ¡ç®¡ç†**ï¼šJSON å…ƒæ•°æ®æ–‡ä»¶ + æ—¥å¿—æ–‡ä»¶
- **è¿›åº¦è§£æ**ï¼šç»“æ„åŒ–æ—¥å¿—æ ‡è®°ï¼ˆ`[PROGRESS]`ã€`[SUCCESS]`ã€`[FAILED]`ï¼‰
- **çŠ¶æ€æ£€æµ‹**ï¼šé€šè¿‡ `os.kill(pid, 0)` æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜åœ¨
- **uv åŠ é€Ÿ**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ uvï¼ˆRust å®ç°çš„ Python åŒ…ç®¡ç†å™¨ï¼‰ï¼Œå¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ° pip

## æ€§èƒ½ä¼˜åŒ–

### uv åŠ é€Ÿè¯´æ˜

ç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•ä½¿ç”¨ [uv](https://github.com/astral-sh/uv) æ›¿ä»£ pip è¿›è¡Œä¾èµ–å®‰è£…ï¼š

- **å¹¶è¡Œä¸‹è½½**ï¼šåŒæ—¶ä¸‹è½½å¤šä¸ªåŒ…ï¼Œå……åˆ†åˆ©ç”¨ç½‘ç»œå¸¦å®½
- **æ›´å¿«çš„ä¾èµ–è§£æ**ï¼šRust å®ç°ï¼Œè§£æé€Ÿåº¦æ¯” pip å¿« 10-100 å€
- **é›¶é…ç½®**ï¼šå®Œå…¨å…¼å®¹ pip å‚æ•°ï¼Œæ— éœ€ä¿®æ”¹é…ç½®
- **è‡ªåŠ¨é™çº§**ï¼šå¦‚æœ uv ä¸å¯ç”¨æˆ–å®‰è£…å¤±è´¥ï¼Œè‡ªåŠ¨å›é€€åˆ° pip

**é¢„æœŸæ€§èƒ½æå‡**ï¼š

- é¦–æ¬¡å®‰è£…å¤§å‹é¡¹ç›®ï¼š10-100 å€åŠ é€Ÿ
- å¢é‡å®‰è£…ï¼š5-20 å€åŠ é€Ÿ
- å°å‹é¡¹ç›®ï¼š2-5 å€åŠ é€Ÿ

**é¦–æ¬¡è¿è¡Œæ—¶**ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å®‰è£… uvï¼ˆå¦‚æœæœªå®‰è£…ï¼‰ï¼Œåç»­è¿è¡Œå°†ç›´æ¥ä½¿ç”¨ã€‚
